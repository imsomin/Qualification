# SQL응용

## (7-1) 데이터베이스 기본

### 1. 트랜잭션(Transaction)
- 인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야 하는 특성이자, 데이터베이스 시스템에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위
- 특성 : 원자성(Rollback, Commit), 일관성(무결성 제약조건), 격리성(Serializable), 영속성(회복기법)
- 상태
  - 활동 상태(Active): 초기 상태, 트랜잭션이 실행 중일 때 가지는 상태 
  - 부분 완료 상태(Partially Committed): 마지막 명령문이 실행된 후에 가지는 상태
  - 완료 상태(Committed): 트랜잭션이 성공적으로 완료된 후 가지는 상태
  - 실패 상태(Failed): 정상적인 실행이 더 이상 진행될 수 없을 때 가지는 상태
  - 철회 상태(Aborted): 트랜잭션이 취소되고 데이터베이스가 트랜잭션 시작 전 상태로 환원된 상태


### 1-1. 트랜잭션 제어
- 트랜잭션 제어언어는 TCL(Transaction Control Language)이라고 하며, 트랜잭션의 결과를 허용하거나 취소하는 목적으로 사용되는 언어를 지칭한다.
- TCL 명령어
  - 커밋: 트랜잭션 확정
  - 롤백: 트랜잭션 취소
  - 체크포인트: 저장 시기 설정


### 1-2. 병행 제어(일관성 주요 기법)
- 병행제어(Concurrency Control)는 다수 사용자 환경에서 여러 트랜잭션을 수행할 때, 데이터베이스 일관성 유지를 위해 상호작용을 제어하는 기법이다.
- 목적: 데이터베이스 공유 최대화, 시스템 활용도 최대화, 데이터베이스 일관성 유지, 사용자에 대한 응답시간 최소화
- 병행제어 미보장 시 문제점
  - 갱신 손실(Lost Update)
  - 현황 파악오류(Dirty Read)
  - 모순성(Inconsistency)
  - 연쇄복귀(Cascading Rollback)
- 병행제어 기법의 종류
  - 로킹(Locking): 트랜잭션의 순차적 진행을 보장하는 직렬화 기법
    - 로킹의 특징
      - 데이터베이스, 파일, 레코드 등을 로킹 단위가 될 수 있음
      - 로킹 단위가 작아지면 데이터베이스 공유도가 증가
      - 로킹 단위가 작아지면 로킹 오버헤드 증가
      - 한꺼번에 로킹할 수 있는 객체의 크기를 로킹 단위라고 함
  - 낙관적 검증: 트랜잭션이 어떠한 검증 수행 없이 수행된 뒤, 트랜잭션이 종료 시 검증을 수행하여 데이터베이스에 반영하는 기법
  - 타임 스탬프 순서(Time Stamp Ordering): 트랜잭션과 트랜잭션이 읽거나 갱신한 데이터에 대해, 트랜잭션이 실행되기 전 타임 스탬프를 부여하여 부여된 시간에 따라 트랜잭션을 수행하는 기법
  - 다중버전 동시성 제어(MVCC; Multi Version Concurrency Control): 트랜잭션의 타임스탬프와 접근하려는 데이터의 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근하도록 하는 기법


### 1-3. 데이터베이스 고립화 수준(격리성 주요 기법)
- 고립화 수준(Isolation Level): 다른 트랜잭션이 현재의 데이터에 대한 무결성을 해치지 않기 위해 잠금을 설정하는 정도
- 종류
  - Read Uncommitted: 한 트랜잭션에서 연산 중인 데이터를 다른 트랜잭션이 읽는 것을 허용하는 수준
  - Read Committed: 한 트랜잭션에서 연산을 수행할 때, 연산이 완료될 때까지 데이터에 대한 읽기를 제한하는 수준
  - Repeatable Read: 선행 트랜잭션이 특정 데이터를 읽을 때, 트랜잭션 종료 시까지 해당 데이터에 대한 갱신을 제한하는 수준
  - Serializable Read: 선행 트랜잭션이 특정 데이터 영역을 순차적으로 읽을 때, 해당 데이터에 대한 접근을 제한하는 수준


### 1-4. 회복 기법(영속성 주요 기법)
- 회복 기법(Recovery): 트랜잭션을 수행하는 도중 장애로 인해 손상된 데이터베이스를 손상되기 이전의 정상적인 상태로 복구시키는 작업
- 종류
  - 로그 기반 회복 기법
    - 지연 갱신 회복 기법: 트랜잭션이 완료되기 전까지 데이터베이스에 기록하지 않는 기법
    - 즉각 갱신 회복 기법: 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영하는 기법
  - 체크 포인트 회복 기법: 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원시키는 회복 기법
  - 그림자 페이징 회복 기법: 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법


### 2. 데이터 정의어, DDL(Data Definition Language)
- 데이터 정의어는 데이터를 정의하는 언어로서 '데이터를 담는 그릇을 정의하는 언어'이다.
- 테이블과 같은 데이터 구조를 정의하는 데 사용되는 명령어들로 특정 구조를 생성, 변경, 삭제, 이름을 바꾸는 데이터 구조와 관련된 명령어들을 데이터 정의어라고 부른다.
- DDL 대상
  - 도메인: 하나의 속성이 가질 수 있는 원자값들의 집합, 속성의 데이터 타입과 크기 및 제약조건 등의 정보
  - 스키마: 데이터베이스의 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조
    - 외부 스키마: 사용자나 개발자의 관점에서 필요로 하는 데이터베이스의 논리적 구조
    - 개념 스키마: 데이터베이스의 전체적인 논리적 구조
    - 내부 스키마: 물리적 저장장치의 관점에서 보는 데이터베이스 구조
  - 테이블: 데이터 저장 공간
  - 뷰: 하나 이상의 물리 테이블에서 유도되는 가상의 테이블
  - 인덱스: 검색을 빠르게 하기 위한 데이터 구조


### 2-1. 인덱스(Index)
- 인덱스는 데이터를 빠르게 찾을 수 있는 수단으로서, 테이블에 대한 조회 속도를 높여 주는 자료 구조이다.
- 인덱스는 테이블의 특정 레코드 위치를 알려 주는 용도로 사용한다.
- 특징
  - 기본 키(PK; Primary Key) 컬럼은 자동으로 인덱스가 생성된다.
  - 연월일이나 이름을 기준으로 하는 인덱스는 자동으로 생성되지 않는다.
  - 테이블의 컬럼에 인덱스가 없는 경우, 테이블의 전체 내용을 검색한다.(테이블 전체 스캔; Table Full Scan)
  - 인덱스가 생성되어 있을 때 데이터를 빠르게 찾을 수 있다(인덱스 범위 스캔; Index Range Scan)
  - 조건절에 '='로 비교되는 컬럼을 대상으로 인덱스를 생성하면 검색 속도를 높일 수 있다.
- 종류
  - 순서 인덱스
  - 해시 인덱스
  - 비트맵 인덱스
  - 함수기반 인덱스
  - 단일 인덱스
  - 결합 인덱스
  - 클러스터드 인덱스


### 2-2. DDL 명령어
- CREATE
- ALTER
- DROP
- TRUNCATE


### 2-3. INDEX 관련 DDL
- CREATE INDEX : 인덱스를 생성하는 명령
  - UNIQUE는 생략 가능하고, 인덱스 걸린 컬럼에 중복 값을 허용하지 않는다.
  - 복수 컬럼을 인덱스로 걸 수 있다.
  - 문법 : CREATE [ UNIQUE ] INDEX 인덱스명 ON 테이블명(컬럼명1, 컬럼명2, ...);
- ALTER INDEX : 인덱스를 수정하는 명령
  - 일부 DBMS는 ALTER INDEX를 제공하지 않는다.
  - 기존 인덱스를 삭제하고 신규 인덱스를 생성하는 방식으로 사용을 권고한다.
  - 문법 : ALTER [ UNIQUE ] INDEX 인덱스명 ON 테이블명(컬럼명1, 컬럼명2, ...);
- DROP INDEX : 인덱스를 삭제하는 명령
  - 문법 : DROP INDEX 인덱스명;


### 3. 데이터 조작어, DML(Data Manipulation Language)
- 데이터 조작어는 데이터베이스에 저장된 자료들을 입력, 수정, 삭제, 조회하는 언어이다.
- 유형
  - SELECT
  - INSERT
  - UPDATE
  - DELETE
- SELECT(데이터 조회) 명령어
  - 데이터의 내용을 조회할 때 사용하는 명령어로 SELECT절, FROM절, WHERE절, GROUP BY 절, HAVING 절, ORDER BY 절로 구성된다.





